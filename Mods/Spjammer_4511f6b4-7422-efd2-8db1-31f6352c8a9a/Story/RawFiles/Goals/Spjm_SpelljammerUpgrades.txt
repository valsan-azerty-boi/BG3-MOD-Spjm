Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION
//REGION SPJM Spelljammer Upgrade Device dialog

PROC
PROC_ProcessUseOfItem((CHARACTER)_Player, (GUIDSTRING)S_SPJM_Ship_AstralEnhancementDevice_923fcb9e-0b18-45d9-9358-575bdf62b809, _)
AND
NOT IsLocked((GUIDSTRING)S_SPJM_Ship_AstralEnhancementDevice_923fcb9e-0b18-45d9-9358-575bdf62b809, 1)
AND
NOT QRY_StartDialog_Fixed((DIALOGRESOURCE)Dialog_SpelljammerShip_AstralEnhDevice_856b9f03-e250-143e-74f3-f5f4613712c3, (GUIDSTRING)_Player, (GUIDSTRING)S_SPJM_Ship_AstralEnhancementDevice_923fcb9e-0b18-45d9-9358-575bdf62b809)
THEN
PROC_TryStartAD((DIALOGRESOURCE)Dialog_SpelljammerShip_AstralEnhDevice_856b9f03-e250-143e-74f3-f5f4613712c3, (GUIDSTRING)_Player, (GUIDSTRING)S_SPJM_Ship_AstralEnhancementDevice_923fcb9e-0b18-45d9-9358-575bdf62b809);

//END_REGION

//REGION SPJM Spelljammer Upgrade Ballistae

IF
CastSpell(_Spell, "Shout_Spjm_PurchaseOrderBallistae", _, _, _)
AND
DB_Players(_Player)
THEN
SetFlag((FLAG)SPJM_Spelljammer_Ship_Ballistae_Unlockable_fba4506e-b8e4-420d-98cf-cd717405523f, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

IF
DB_GlobalFlag((FLAG)SPJM_Spelljammer_Ship_Ballistae_Unlocked_1064032c-df91-4ecb-b409-aa3969da66ef)
AND
DB_Players(_Player)
THEN
AddSpell((CHARACTER)_Player, "ProjectileStrike_Spjm_ShipStrike_Ballistae", 1, 0);

//END_REGION

//REGION SPJM Spelljammer Upgrade Canon

IF
CastSpell(_Spell, "Shout_Spjm_PurchaseOrderCanon", _, _, _)
AND
DB_Players(_Player)
THEN
SetFlag((FLAG)SPJM_Spelljammer_Ship_Canon_Unlockable_60d733b3-ad1a-422b-97f9-650491569ba9, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

IF
DB_GlobalFlag((FLAG)SPJM_Spelljammer_Ship_Canon_Unlocked_88741912-bd5d-42f0-a686-488ba6b79eea)
AND
DB_Players(_Player)
THEN
AddSpell((CHARACTER)_Player, "ProjectileStrike_Spjm_ShipStrike_Canon", 1, 0);

//END_REGION
EXITSECTION

ENDEXITSECTION
